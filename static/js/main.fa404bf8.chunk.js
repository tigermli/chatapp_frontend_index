(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],[,,,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var s=n(0),a=n(1),r=n.n(a),c=n(10),i=n.n(c),o=(n(16),n(2)),u=(n(17),n(9),n(6),n(7),n(18),function(e){var t=Object(a.useState)("https://chat.cs291.com"),n=Object(o.a)(t,2),r=n[0],c=n[1],i=Object(a.useState)(""),u=Object(o.a)(i,2),l=u[0],d=u[1],j=Object(a.useState)(""),b=Object(o.a)(j,2),h=b[0],g=b[1];return e.disableChat?Object(s.jsx)("div",{className:"loginBody",children:Object(s.jsxs)("div",{className:"loginContainer",children:[Object(s.jsx)("h1",{className:"loginTitle",children:" DOGE Chat "})," ",Object(s.jsx)("br",{}),Object(s.jsxs)("form",{className:"loginForm",onSubmit:function(t){t.preventDefault();var n=r+"/login",s=new FormData;s.append("username",l),s.append("password",h),fetch(n,{method:"POST",body:s}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(t){sessionStorage.token=t.token,sessionStorage.url=r,e.onSetDisableChat(!1)})).catch((function(e){console.log(e),"Error: 403"==e&&alert("Invalid username or password"),"Error: 422"==e&&alert(e+" failure to /login")}))},children:[Object(s.jsx)("input",{placeholder:"URL",className:"loginInput",value:r,onChange:function(e){return c(e.target.value)}}),Object(s.jsx)("br",{}),Object(s.jsx)("input",{placeholder:"username",className:"loginInput",onChange:function(e){return d(e.target.value)}}),Object(s.jsx)("br",{}),Object(s.jsx)("input",{placeholder:"password",type:"password",className:"loginInput",onChange:function(e){return g(e.target.value)}}),Object(s.jsx)("br",{}),Object(s.jsx)("button",{className:"submit",type:"submit",children:"Submit"})]})]})}):null}),l=n(8),d=(n(19),function(e){function t(e){for(var t=0,n=0;t<e.length;t++)n=Math.imul(31,n)+e.charCodeAt(t)|0;return Math.abs(n)}var n=e.messages.map((function(e,n){return Object(s.jsxs)("div",{children:[e.isMessage&&Object(s.jsx)("img",{src:"https://tigermli.github.io/chatapp_frontend_index/profiles/doge".concat(t(e.user)%9+1,".jpg"),width:"30",height:"30"}),!e.isMessage&&Object(s.jsx)("img",{src:"https://tigermli.github.io/chatapp_frontend_index/profiles/noDoge.png",width:"30",height:"30"}),e.str]},n)})),r=Object(a.useRef)(null);return Object(a.useEffect)((function(){!function(){var e;null===(e=r.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[e]),Object(s.jsxs)("div",{className:"messageListContainer",children:[n,Object(s.jsx)("div",{ref:r})]})}),j=function(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),r=n[0],c=n[1];return Object(s.jsx)("form",{className:"message_form",onSubmit:function(t){t.preventDefault();var n=e.url+"/message";console.log(n);var s=new FormData;s.append("message",r),fetch(n,{method:"POST",headers:new Headers({Authorization:"Bearer "+sessionStorage.getItem("token")}),body:s}).then((function(e){var t=e.status;422===t?alert("Please send a nonempty message"):201===t&&c(""),console.log("Token is: "+sessionStorage.getItem("token")),console.log(e)})).catch((function(e){console.log("IN ERROR STATE"),console.log(e)}))},children:Object(s.jsx)("input",{className:"messageInput",placeholder:"Type message here and press ENTER to send.",type:"text",value:r,onChange:function(e){c(e.target.value)},disabled:e.disabled})})},b=function(e){function t(e){for(var t=0,n=0;t<e.length;t++)n=Math.imul(31,n)+e.charCodeAt(t)|0;return Math.abs(n)}var n=Array.from(e.activeUsers).sort().map((function(e,n){return Object(s.jsxs)("div",{children:[Object(s.jsx)("img",{src:"https://tigermli.github.io/chatapp_frontend_index/profiles/doge".concat(t(e)%9+1,".jpg"),width:"30",height:"30"}),Object(s.jsx)("div",{className:"userItem",children:e},n)]},n)}));return Object(s.jsx)("div",{className:"userListContainer",children:Object(s.jsx)("div",{className:"userList",children:n})})},h=function(e){var t=Object(a.useState)(new Set),n=Object(o.a)(t,2),r=n[0],c=n[1],i=Object(a.useState)([]),u=Object(o.a)(i,2),h=u[0],g=u[1];function f(e){g((function(t){return[].concat(Object(l.a)(t),[e])}))}function m(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}return Object(a.useEffect)((function(){if(!e.disableChat){var t=new EventSource(sessionStorage.getItem("url")+"/stream/"+sessionStorage.getItem("token"));t.addEventListener("Users",(function(e){c(new Set(JSON.parse(e.data).users))}),!1),t.addEventListener("Message",(function(e){var t=JSON.parse(e.data);f({str:m(t.created)+" ("+t.user+") "+t.message,user:t.user,isMessage:!0})}),!1),t.addEventListener("Disconnect",(function(n){t.close(),e.onSetDisableChat(!0)}),!1),t.addEventListener("ServerStatus",(function(e){var t=JSON.parse(e.data);f({str:m(t.created)+" STATUS: "+t.status,isMessage:!1})}),!1),t.addEventListener("Part",(function(e){var t=JSON.parse(e.data);f({str:m(t.created)+" PART: "+t.user,isMessage:!0,user:t.user}),function(e){c((function(t){var n=new Set(t);return n.delete(e),n}))}(t.user)}),!1),t.addEventListener("Join",(function(e){var t=JSON.parse(e.data);f({str:m(t.created)+" JOIN: "+t.user,isMessage:!0,user:t.user}),function(e){c((function(t){var n=new Set(t);return n.add(e),n}))}(t.user)}),!1)}console.log("visited effect")}),[e.disableChat]),e.disableChat?null:Object(s.jsxs)("div",{className:"chat",children:[Object(s.jsxs)("div",{className:"leftContainer",children:[Object(s.jsx)(d,{messages:Object(l.a)(h)}),Object(s.jsx)(j,{url:sessionStorage.getItem("url"),disabled:e.disableChat})]}),Object(s.jsx)(b,{activeUsers:r})]})},g=function(){var e=Object(a.useState)(!0),t=Object(o.a)(e,2),n=t[0],r=t[1];function c(e){r(e)}return Object(a.useEffect)((function(){null!==sessionStorage.getItem("token")&&r(!1)}),[]),window.addEventListener("unload",(function(e){sessionStorage.clear()})),Object(s.jsxs)("div",{children:[Object(s.jsx)(u,{disableChat:n,onSetDisableChat:c}),Object(s.jsx)(h,{disableChat:n,onSetDisableChat:c})]})},f=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),s(e),a(e),r(e),c(e)}))};i.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(g,{})}),document.getElementById("root")),f()}],[[20,1,2]]]);
//# sourceMappingURL=main.fa404bf8.chunk.js.map