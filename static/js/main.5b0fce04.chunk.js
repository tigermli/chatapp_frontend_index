(this.webpackJsonpchat_client=this.webpackJsonpchat_client||[]).push([[0],[,,,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var s=n(0),a=n(1),r=n.n(a),c=n(10),o=n.n(c),i=(n(16),n(2)),l=(n(17),n(9),n(6),n(7),n(18),function(e){var t=Object(a.useState)("http://localhost:2000"),n=Object(i.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)(""),l=Object(i.a)(o,2),u=l[0],d=l[1],j=Object(a.useState)(""),b=Object(i.a)(j,2),O=b[0],h=b[1];return e.disableChat?Object(s.jsxs)("div",{className:"loginContainer",children:[Object(s.jsx)("h1",{className:"loginTitle",children:" Login "})," ",Object(s.jsx)("br",{}),Object(s.jsxs)("form",{className:"loginform",onSubmit:function(t){t.preventDefault();var n=r+"/login",s=new FormData;s.append("username",u),s.append("password",O),fetch(n,{method:"POST",body:s}).then((function(e){if(e.ok)return e.json();throw new Error(e.status)})).then((function(t){sessionStorage.token=t.token,sessionStorage.url=r,e.onSetDisableChat(!1)})).catch((function(e){console.log(e),"Error: 403"==e&&alert("Invalid username or password"),"Error: 422"==e&&alert(e+" failure to /login")}))},children:[Object(s.jsx)("label",{htmlFor:"URL",children:"URL:"}),Object(s.jsx)("br",{}),Object(s.jsx)("input",{placeholder:"URL",className:"loginInput",value:r,onChange:function(e){return c(e.target.value)}}),Object(s.jsx)("br",{}),Object(s.jsx)("label",{htmlFor:"username",children:"Username:"}),Object(s.jsx)("br",{}),Object(s.jsx)("input",{placeholder:"username",className:"loginInput",onChange:function(e){return d(e.target.value)}}),Object(s.jsx)("br",{}),Object(s.jsx)("label",{htmlFor:"password",children:"Password:"}),Object(s.jsx)("br",{}),Object(s.jsx)("input",{placeholder:"password",type:"password",className:"loginInput",onChange:function(e){return h(e.target.value)}}),Object(s.jsx)("br",{}),Object(s.jsx)("button",{type:"submit",children:"Submit"})]})]}):null}),u=n(8),d=(n(19),function(e){var t=e.messages.map((function(e,t){return Object(s.jsx)("div",{children:e},t)}));return Object(s.jsx)("div",{className:"messageListContainer",children:t})}),j=function(e){var t=Object(a.useState)(""),n=Object(i.a)(t,2),r=n[0],c=n[1];return Object(s.jsx)("form",{className:"send-message",onSubmit:function(t){t.preventDefault();var n=e.url+"/message";console.log(n);var s=new FormData;s.append("message",r),fetch(n,{method:"POST",headers:new Headers({Authorization:"Bearer "+sessionStorage.getItem("token")}),body:s}).then((function(e){var t=e.status;422===t?alert("Please send a nonempty message"):201===t&&c(""),console.log("Token is: "+sessionStorage.getItem("token")),console.log(e)})).catch((function(e){console.log("IN ERROR STATE"),console.log(e)}))},children:Object(s.jsx)("input",{placeholder:"Type message here and press ENTER to send.",type:"text",value:r,onChange:function(e){c(e.target.value)},disabled:e.disabled})})},b=function(e){var t=Array.from(e.activeUsers).sort().map((function(e,t){return Object(s.jsx)("li",{children:e},t)}));return Object(s.jsxs)("div",{className:"userListContainer",children:[Object(s.jsx)("h2",{className:"UserListTitle",children:" Active Users "}),Object(s.jsx)("ul",{className:"userList",children:t})]})},O=function(e){var t=Object(a.useState)(new Set),n=Object(i.a)(t,2),r=n[0],c=n[1],o=Object(a.useState)([]),l=Object(i.a)(o,2),O=l[0],h=l[1];function f(e){h((function(t){return[].concat(Object(u.a)(t),[e])}))}function g(e){var t=new Date(1e3*e);return t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US")}return Object(a.useEffect)((function(){console.log("edited users"),console.log(r)}),[r]),Object(a.useEffect)((function(){if(!e.disableChat){var t=new EventSource(sessionStorage.getItem("url")+"/stream/"+sessionStorage.getItem("token"));t.addEventListener("Users",(function(e){c(new Set(JSON.parse(e.data).users))}),!1),t.addEventListener("Message",(function(e){f(g(JSON.parse(e.data).created)+" ("+JSON.parse(e.data).user+") "+JSON.parse(e.data).message),console.log(JSON.parse(e.data))}),!1),t.addEventListener("Disconnect",(function(n){t.close(),e.onSetDisableChat(!0),console.log(JSON.parse(n.data))}),!1),t.addEventListener("ServerStatus",(function(e){f(g(JSON.parse(e.data).created)+" STATUS: "+JSON.parse(e.data).status),console.log(JSON.parse(e.data))}),!1),t.addEventListener("Part",(function(e){var t=JSON.parse(e.data);f(g(t.created)+" PART: "+t.user),function(e){c((function(t){var n=new Set(t);return n.delete(e),n}))}(t.user)}),!1),t.addEventListener("Join",(function(e){var t=JSON.parse(e.data);f(g(t.created)+" JOIN: "+t.user),function(e){c((function(t){var n=new Set(t);return n.add(e),n}))}(t.user)}),!1)}console.log("visited effect")}),[e.disableChat]),e.disableChat?null:Object(s.jsxs)("div",{className:"chat",children:[Object(s.jsx)(b,{activeUsers:r}),Object(s.jsx)(d,{messages:Object(u.a)(O)}),Object(s.jsx)(j,{url:sessionStorage.getItem("url"),disabled:e.disableChat})]})},h=function(){var e=Object(a.useState)(!0),t=Object(i.a)(e,2),n=t[0],r=t[1];function c(e){r(e)}return Object(a.useEffect)((function(){null!==sessionStorage.getItem("token")&&r(!1)}),[]),window.addEventListener("unload",(function(e){sessionStorage.clear()})),Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)("div",{class:"header",children:Object(s.jsx)("h1",{children:"DogeChat"})}),Object(s.jsx)(l,{disableChat:n,onSetDisableChat:c}),Object(s.jsx)(O,{disableChat:n,onSetDisableChat:c})]})},f=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,s=t.getFID,a=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),s(e),a(e),r(e),c(e)}))};o.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(h,{})}),document.getElementById("root")),f()}],[[20,1,2]]]);
//# sourceMappingURL=main.5b0fce04.chunk.js.map